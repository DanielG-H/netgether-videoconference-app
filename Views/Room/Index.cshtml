@model User
@{ 
    Layout = "";
    ViewData["Title"] = "Chat Room";
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="~/css/room.css" />
</head>
<body>
    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
        <a href="#">Video</a>
        <a href="#">Audio</a>
        <a href="#"></a>
        <a href="#"></a>
        <a href="#"></a>
        <a class="btn btn-danger justify-content-center" asp-controller="Home" asp-action="Index"><i class="bi bi-door-closed">&nbsp; Log Out</i></a>
    </div>
    <div id="myChat" class="chat">
        <a href="javascript:void(0)" class="closebtn" onclick="closeChat()">×</a>
        <a href="#">Chat</a>
        <div class="row d-flex justify-content-center">
            <div class="col-md-2 col-lg-11">
                <div class="card shadow-0 border" style="background-color: #f0f2f5;">
                    <div class="card-body p-4">
                        <div class="card mb-4">
                            <div class="card-body">
                                <p>Type your note, and hit enter to add it</p>

                                <div class="d-flex justify-content-between">
                                    <div class="d-flex flex-row align-items-center">
                                        <img src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(4).webp" alt="avatar" width="25"
                                             height="25" />
                                        <p class="small mb-0 ms-2">Martha</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card mb-4">
                            <div class="card-body">
                                <p>Type your note, and hit enter to add it</p>

                                <div class="d-flex justify-content-between">
                                    <div class="d-flex flex-row align-items-center">
                                        <img src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(32).webp" alt="avatar" width="25"
                                             height="25" />
                                        <p class="small mb-0 ms-2">Johny Blaze</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card mb-4">
                            <div class="card-body">
                                <p>Type your note, and hit enter to add it</p>

                                <div class="d-flex justify-content-between">
                                    <div class="d-flex flex-row align-items-center">
                                        <img src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(31).webp" alt="avatar" width="25"
                                             height="25" />
                                        <p class="small mb-0 ms-2">Mary Jane</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-outline">
                            <input type="text" id="addComment" class="form-control" placeholder="Type comment..." />
                            <button id="sendButton" class="btn btn-primary mb-8">+ Add </button>
                            <file id="button-attach-file" type="button" class="btn btn-secondary"> <i class="bi bi-paperclip">File</i></file>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="main">
        <h2>Body...</h2>
        <p>Work in progress...</p>
    </div>

    <div class="dockbg"></div>
    <div class="dock">
        <button class="openbtn" onclick="openNav()">☰</button>
        <button class="openbtn" onclick="openChat()">	➥</button>
    </div>


    <!-- webRTC API -->
    <!-- bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <!-- signalR -->
    <script src="~/js/signalr/dist/browser/signalr.js"></script>
    <script type="text/javascript">
        function openNav() {
            document.getElementById("mySidebar").style.width = "250px";
            document.getElementById("main").style.marginLeft = "250px";
        }

        function closeNav() {
            document.getElementById("mySidebar").style.width = "0";
            document.getElementById("main").style.marginLeft = "0";

        }

        function openChat() {
            document.getElementById("myChat").style.width = "450px";
            document.getElementById("main").style.marginRight = "450px";
        }

        function closeChat() {
            document.getElementById("myChat").style.width = "0";
            document.getElementById("main").style.marginRight = "0";
        }

        "use strict";

        var connection = new signalR.HubConnectionBuilder().withUrl("/Room/Index").build();

        connection.start().then(function () {
            console.log("SignalR connected");
        }).catch(function (error) {
            console.error("SignalR connection error: " + error);
        });

        // sends a comment
        function sendComment(userId, message) {
            connection.invoke("SendComment", userId, message).catch(function (err) {
                console.error(err.toString());
            });
        }

        function isBlank(str) {
            return (!str || /^\s*$/.test(str));
        }

        // handles sending a comment and is called on Enter or on Click
        function handleSendComment() {
            var comment = document.getElementById("addComment").value;
            if (!isBlank(comment)) {
                console.log("Comment to send: " + comment);
                sendComment(@Model.UserId, comment);
                document.getElementById("addComment").value = "";
            }
        }

        // add event listener to button click
        var sendButton = document.getElementById("sendButton");
        sendButton.addEventListener("click", handleSendComment);

        // add event listener to Enter key press
        var messageInput = document.getElementById("addComment");
        messageInput.addEventListener("keydown", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                handleSendComment();
            }
        })

        function displayComment(comment) {
            var messageElement = document.createElement("p");
            var username = "@Model.Username";
            console.log("Displayed comment: " + comment + "\nUsername: " + username);
            messageElement.textContent = username + ": " + comment;
            var cardBody = document.querySelector(".card-body")
            if (cardBody) {
                cardBody.appendChild(messageElement);
            }
        }

        connection.on("ReceiveComment", function (comment) {
            // handle the received comment
            console.log("Received comment: " + comment);
            displayComment(comment);
        });
    </script>
</body>
</html> 